<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>CardGen.io - Instant Card Generator</title>

	<!-- Tailwind CSS (CDN) -->
	<script src="https://cdn.tailwindcss.com"></script>

	<!-- Google Fonts (curated set) -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Inter:wght@400;600;700&family=Lora:ital,wght@0,400;0,700;1,400;1,700&family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&family=Montserrat:wght@400;600;700&family=Poppins:wght@400;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Roboto+Mono:wght@400;700&family=Source+Serif+4:ital,opsz,wght@0,8..60,400;0,8..60,700;1,8..60,400&family=Work+Sans:wght@400;600;700&display=swap" rel="stylesheet">

	<!-- html2canvas for image generation -->
	<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
	<!-- Vercel web analytics -->
	<script>window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };</script>
	<script defer src="/_vercel/insights/script.js"></script>

	<!-- App Styles -->
	<style>
		/* Utility for visually smooth font rendering on canvas capture */
		#cardCanvas {
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
			text-rendering: optimizeLegibility;
		}
		/* Hide focus outlines on swatch buttons while keeping accessibility */
		.swatch:focus-visible {
			outline: 2px solid #6366f1; /* indigo-500 */
			outline-offset: 2px;
		}
	</style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">
	<!-- Header -->
	<header class="w-full border-b border-slate-200 bg-white/80 backdrop-blur sticky top-0 z-40">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
			<div class="flex items-center gap-3">
				<img src="cardgenio.png" alt="CardGen.io" class="h-9 w-9 rounded-lg object-contain bg-white border border-slate-200" />
				<div>
					<h1 class="text-xl font-semibold tracking-tight">CardGen.io</h1>
					<p class="text-xs text-slate-500 -mt-0.5">Instant card generator for social posts</p>
				</div>
			</div>
			<div class="hidden sm:flex items-center gap-3 text-xs text-slate-500">
				<span class="px-2 py-1 rounded bg-slate-100">No sign-up</span>
				<span class="px-2 py-1 rounded bg-slate-100">Fully client-side</span>
				<span class="px-2 py-1 rounded bg-slate-100">Free to use</span>
			</div>
		</div>
	</header>

	<!-- Main -->
	<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 md:py-10">
		<div class="grid grid-cols-1 xl:grid-cols-3 gap-6 md:gap-8">
			<!-- Preview Column -->
			<section class="xl:col-span-2">
				<div class="mb-4 flex items-center justify-between">
					<h2 class="text-lg font-semibold">Live Preview</h2>
					<div id="aspectLabel" class="text-xs text-slate-500">Aspect 1:1 • What you see is what you get</div>
				</div>

				<!-- Preview Card Canvas (square) -->
				<div class="relative">
					<div id="cardCanvas"
						class="aspect-square w-full bg-white rounded-2xl shadow-lg overflow-hidden border border-slate-200 relative flex">
						<!-- Background layer (solid or gradient inline styles applied via JS) -->
						<div id="bgLayer" class="absolute inset-0"></div>

						<!-- Foreground Content -->
						<div class="relative z-10 w-full h-full p-6 sm:p-8 lg:p-12 flex">
							<div class="w-full h-full flex flex-col justify-center items-center text-center">
								<!-- Main Text -->
								<div id="mainText"
									class="whitespace-pre-wrap break-words max-w-[90%] mx-auto font-serif"
									style="font-family: 'Lora', serif; color: #0f172a; font-size: 40px; line-height: 1.25;">
									Your inspiring quote goes here. Make it short and impactful.
								</div>

								<!-- Author / Handle -->
								<div id="authorText"
									class="mt-6 text-slate-700"
									style="font-family: 'Inter', sans-serif; font-size: 20px; line-height: 1.25; color: #334155;">
									— @cardgenio
								</div>
							</div>
						</div>

						<!-- Watermark -->
						<div id="watermark"
							class="absolute bottom-3 right-3 text-[10px] sm:text-xs px-2 py-1 rounded bg-black/40 text-white select-none">
							CardGen.io
						</div>
					</div>
				</div>

				<!-- Orientation Selector -->
				<div class="mt-4">
					<div class="text-xs text-slate-500 mb-2">Orientations</div>
					<div class="flex flex-wrap gap-2">
						<button class="ratioBtn px-3 py-1.5 rounded-md border border-slate-200 bg-slate-100 text-slate-700 text-sm" data-ratio="1:1">1:1</button>
						<button class="ratioBtn px-3 py-1.5 rounded-md border border-slate-200 bg-white text-slate-700 text-sm" data-ratio="4:5">4:5</button>
						<button class="ratioBtn px-3 py-1.5 rounded-md border border-slate-200 bg-white text-slate-700 text-sm" data-ratio="3:4">3:4</button>
						<button class="ratioBtn px-3 py-1.5 rounded-md border border-slate-200 bg-white text-slate-700 text-sm" data-ratio="2:3">2:3</button>
						<button class="ratioBtn px-3 py-1.5 rounded-md border border-slate-200 bg-white text-slate-700 text-sm" data-ratio="9:11">9:11</button>
						<button class="ratioBtn px-3 py-1.5 rounded-md border border-slate-200 bg-white text-slate-700 text-sm" data-ratio="9:16">9:16</button>
						<button class="ratioBtn px-3 py-1.5 rounded-md border border-slate-200 bg-white text-slate-700 text-sm" data-ratio="16:9">16:9</button>
						<button class="ratioBtn px-3 py-1.5 rounded-md border border-slate-200 bg-white text-slate-700 text-sm" data-ratio="1.91:1">1.91:1</button>
						<button class="ratioBtn px-3 py-1.5 rounded-md border border-slate-200 bg-white text-slate-700 text-sm" data-ratio="5:4">5:4</button>
					</div>
				</div>

				<!-- Actions -->
				<div class="mt-6 flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
					<button id="downloadBtn"
						class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 active:bg-indigo-800 transition shadow-sm">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4v12m0 0l-3.5-3.5M12 16l3.5-3.5M4 20h16"/>
						</svg>
						Download PNG (Hi-Res)
					</button>
					<button id="resetBtn"
						class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-md bg-white text-slate-700 hover:bg-slate-50 active:bg-slate-100 transition border border-slate-200">
						Reset
					</button>

					<!-- Ad Placeholder (non-intrusive) -->
					<!-- <div class="sm:ml-auto w-full sm:w-72 h-12 rounded-md border border-dashed border-slate-300 bg-white text-slate-400 grid place-items-center text-xs">
						Ad placeholder
					</div> -->
				</div>
			</section>

			<!-- Controls Column -->
			<aside class="xl:col-span-1">
				<div class="mb-4">
					<h2 class="text-lg font-semibold">Editor</h2>
					<p class="text-xs text-slate-500">Customize text, fonts, and background</p>
				</div>

				<div class="space-y-6">
					<!-- Text Inputs -->
					<div class="p-4 rounded-xl bg-white border border-slate-200 shadow-sm">
						<h3 class="text-sm font-semibold mb-3">Text</h3>
						<label class="block text-xs text-slate-500 mb-1" for="quoteInput">Main text</label>
						<textarea id="quoteInput" rows="4"
							class="w-full resize-y rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500 text-sm"
							placeholder="Type your quote, tip, or poem...">Your inspiring quote goes here. Make it short and impactful.</textarea>

						<div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3">
							<div>
								<label class="block text-xs text-slate-500 mb-1" for="authorInput">Author / handle</label>
								<input id="authorInput" type="text"
									class="w-full rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500 text-sm"
									placeholder="@yourhandle or — Author name" value="— @cardgenio" />
							</div>
							<div class="flex items-center gap-2 pt-5 sm:pt-0">
								<input id="authorItalic" type="checkbox" class="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
								<label for="authorItalic" class="text-xs text-slate-600">Italic author</label>
							</div>
						</div>
					</div>

					<!-- Font Controls -->
					<div class="p-4 rounded-xl bg-white border border-slate-200 shadow-sm">
						<h3 class="text-sm font-semibold mb-3">Typography</h3>

						<div class="grid grid-cols-1 gap-4">
							<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
								<div>
									<label class="block text-xs text-slate-500 mb-1" for="fontSelect">Main font</label>
									<select id="fontSelect"
										class="w-full rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500 text-sm">
										<option value="'Lora', serif" selected>Lora (serif)</option>
										<option value="'Playfair Display', serif">Playfair Display (serif)</option>
										<option value="'Merriweather', serif">Merriweather (serif)</option>
										<option value="'Source Serif 4', serif">Source Serif 4 (serif)</option>
										<option value="'Inter', sans-serif">Inter (sans)</option>
										<option value="'Poppins', sans-serif">Poppins (sans)</option>
										<option value="'Montserrat', sans-serif">Montserrat (sans)</option>
										<option value="'DM Sans', sans-serif">DM Sans (sans)</option>
										<option value="'Work Sans', sans-serif">Work Sans (sans)</option>
										<option value="'Roboto Mono', monospace">Roboto Mono (mono)</option>
									</select>
								</div>
								<div>
									<label class="block text-xs text-slate-500 mb-1" for="authorFontSelect">Author font</label>
									<select id="authorFontSelect"
										class="w-full rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500 text-sm">
										<option value="'Inter', sans-serif" selected>Inter (sans)</option>
										<option value="'Poppins', sans-serif">Poppins (sans)</option>
										<option value="'Montserrat', sans-serif">Montserrat (sans)</option>
										<option value="'DM Sans', sans-serif">DM Sans (sans)</option>
										<option value="'Work Sans', sans-serif">Work Sans (sans)</option>
										<option value="'Lora', serif">Lora (serif)</option>
										<option value="'Playfair Display', serif">Playfair Display (serif)</option>
										<option value="'Merriweather', serif">Merriweather (serif)</option>
										<option value="'Source Serif 4', serif">Source Serif 4 (serif)</option>
										<option value="'Roboto Mono', monospace">Roboto Mono (mono)</option>
									</select>
								</div>
							</div>

							<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
								<div>
									<label class="flex items-center justify-between text-xs text-slate-500 mb-1">
										<span>Main size</span>
										<span><span id="fontSizeValue">40</span> px</span>
									</label>
									<input id="fontSize" type="range" min="18" max="96" step="1" value="40"
										class="w-full accent-indigo-600">
								</div>
								<div>
									<label class="flex items-center justify-between text-xs text-slate-500 mb-1">
										<span>Author size</span>
										<span><span id="authorFontSizeValue">20</span> px</span>
									</label>
									<input id="authorFontSize" type="range" min="12" max="48" step="1" value="20"
										class="w-full accent-indigo-600">
								</div>
							</div>
						</div>
					</div>

					<!-- Color Controls -->
					<div class="p-4 rounded-xl bg-white border border-slate-200 shadow-sm">
						<h3 class="text-sm font-semibold mb-3">Colors</h3>

						<div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
							<div>
								<label class="block text-xs text-slate-500 mb-1" for="textColor">Main text</label>
								<input id="textColor" type="color" value="#0f172a"
									class="w-full h-9 rounded-md border border-slate-200 cursor-pointer">
							</div>
							<div>
								<label class="block text-xs text-slate-500 mb-1" for="authorColor">Author text</label>
								<input id="authorColor" type="color" value="#334155"
									class="w-full h-9 rounded-md border border-slate-200 cursor-pointer">
							</div>
							<div>
								<label class="block text-xs text-slate-500 mb-1" for="bgColor">Background (solid)</label>
								<input id="bgColor" type="color" value="#ffffff"
									class="w-full h-9 rounded-md border border-slate-200 cursor-pointer">
							</div>
						</div>

						<!-- Background Mode -->
						<div class="mt-4 flex flex-wrap items-center gap-3">
							<span class="text-xs text-slate-500">Background:</span>
							<label class="inline-flex items-center gap-2 text-sm">
								<input type="radio" name="bgMode" value="solid" class="text-indigo-600" checked>
								<span>Solid</span>
							</label>
							<label class="inline-flex items-center gap-2 text-sm">
								<input type="radio" name="bgMode" value="gradient" class="text-indigo-600">
								<span>Gradient</span>
							</label>
						</div>

						<!-- Pre-made Palettes -->
						<div class="mt-4">
							<div class="flex items-center justify-between mb-2">
								<label class="text-xs text-slate-500">Palettes</label>
								<button id="invertColors" class="text-xs text-indigo-600 hover:underline">Invert text colors</button>
							</div>
							<div class="grid grid-cols-5 gap-2">
								<!-- Each swatch sets a solid background + text combos -->
								<button class="swatch h-9 rounded border border-slate-200"
									title="Classic on white" data-palette='{"bg":"#ffffff","text":"#0f172a","author":"#334155"}'
									style="background: linear-gradient(90deg,#ffffff 50%, #0f172a 50%);"></button>
								<button class="swatch h-9 rounded border border-slate-200"
									title="Dark mode" data-palette='{"bg":"#0f172a","text":"#ffffff","author":"#cbd5e1"}'
									style="background: linear-gradient(90deg,#0f172a 50%, #ffffff 50%);"></button>
								<button class="swatch h-9 rounded border border-slate-200"
									title="Indigo" data-palette='{"bg":"#eef2ff","text":"#3730a3","author":"#4338ca"}'
									style="background: linear-gradient(90deg,#eef2ff 50%, #3730a3 50%);"></button>
								<button class="swatch h-9 rounded border border-slate-200"
									title="Emerald" data-palette='{"bg":"#ecfdf5","text":"#065f46","author":"#047857"}'
									style="background: linear-gradient(90deg,#ecfdf5 50%, #065f46 50%);"></button>
								<button class="swatch h-9 rounded border border-slate-200"
									title="Rose" data-palette='{"bg":"#fff1f2","text":"#9f1239","author":"#be123c"}'
									style="background: linear-gradient(90deg,#fff1f2 50%, #9f1239 50%);"></button>
							</div>
						</div>

						<!-- Gradient Swatches -->
						<div class="mt-4">
							<label class="block text-xs text-slate-500 mb-2">Gradients</label>
							<div class="grid grid-cols-3 sm:grid-cols-5 gap-2">
								<button class="grad-swatch h-9 rounded border border-slate-200"
									title="Indigo → Purple"
									data-gradient="linear-gradient(135deg,#6366f1,#a855f7)"></button>
								<button class="grad-swatch h-9 rounded border border-slate-200"
									title="Blue → Cyan"
									data-gradient="linear-gradient(135deg,#3b82f6,#06b6d4)"></button>
								<button class="grad-swatch h-9 rounded border border-slate-200"
									title="Emerald → Teal"
									data-gradient="linear-gradient(135deg,#10b981,#14b8a6)"></button>
								<button class="grad-swatch h-9 rounded border border-slate-200"
									title="Orange → Rose"
									data-gradient="linear-gradient(135deg,#f59e0b,#f43f5e)"></button>
								<button class="grad-swatch h-9 rounded border border-slate-200"
									title="Slate → Zinc"
									data-gradient="linear-gradient(135deg,#64748b,#3f3f46)"></button>
							</div>
						</div>
					</div>

					<!-- Layout Tweaks -->
					<div class="p-4 rounded-xl bg-white border border-slate-200 shadow-sm">
						<h3 class="text-sm font-semibold mb-3">Layout</h3>
						<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
							<div>
								<label class="flex items-center justify-between text-xs text-slate-500 mb-1">
									<span>Padding</span>
									<span><span id="padValue">10</span> %</span>
								</label>
								<input id="padRange" type="range" min="4" max="16" step="1" value="10"
									class="w-full accent-indigo-600">
							</div>
							<div>
								<label class="flex items-center justify-between text-xs text-slate-500 mb-1">
									<span>Line height</span>
									<span><span id="lhValue">1.25</span> ×</span>
								</label>
								<input id="lhRange" type="range" min="1.1" max="1.8" step="0.05" value="1.25"
									class="w-full accent-indigo-600">
							</div>
						</div>
						<div class="mt-3">
							<label class="block text-xs text-slate-500 mb-1">Text alignment</label>
							<div class="flex gap-2">
								<button data-align="left" class="alignBtn px-3 py-1.5 rounded-md border border-slate-200 bg-white text-slate-700 text-sm">Left</button>
								<button data-align="center" class="alignBtn px-3 py-1.5 rounded-md border border-slate-200 bg-white text-slate-700 text-sm">Center</button>
								<button data-align="right" class="alignBtn px-3 py-1.5 rounded-md border border-slate-200 bg-white text-slate-700 text-sm">Right</button>
							</div>
						</div>
					</div>

					<!-- Help -->
					<div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
						<h3 class="text-sm font-semibold mb-2">Tips</h3>
						<ul class="text-xs text-slate-600 space-y-1.5">
							<li>Keep quotes short for best readability.</li>
							<li>Use contrasting text and background colors.</li>
							<li>Gradients look great with white text.</li>
							<li>Click “Download PNG” for a crisp, share-ready image.</li>
						</ul>
					</div>
				</div>
			</aside>
		</div>
	</main>

	<!-- Footer -->
	<footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 text-center text-xs text-slate-500">
		Built with ❤️ — Free to use. No data leaves your browser.
	</footer>

	<!-- App Logic -->
	<script>
		// Elements
		const cardCanvas = document.getElementById('cardCanvas');
		const bgLayer = document.getElementById('bgLayer');
		const mainText = document.getElementById('mainText');
		const authorText = document.getElementById('authorText');
		const watermark = document.getElementById('watermark');
		const aspectLabel = document.getElementById('aspectLabel');

		// Inputs
		const quoteInput = document.getElementById('quoteInput');
		const authorInput = document.getElementById('authorInput');
		const authorItalic = document.getElementById('authorItalic');

		const fontSelect = document.getElementById('fontSelect');
		const authorFontSelect = document.getElementById('authorFontSelect');

		const fontSize = document.getElementById('fontSize');
		const fontSizeValue = document.getElementById('fontSizeValue');
		const authorFontSize = document.getElementById('authorFontSize');
		const authorFontSizeValue = document.getElementById('authorFontSizeValue');

		const textColor = document.getElementById('textColor');
		const authorColor = document.getElementById('authorColor');
		const bgColor = document.getElementById('bgColor');

		const bgModeRadios = document.querySelectorAll('input[name="bgMode"]');
		const paletteSwatches = document.querySelectorAll('.swatch');
		const gradientSwatches = document.querySelectorAll('.grad-swatch');

		const padRange = document.getElementById('padRange');
		const padValue = document.getElementById('padValue');
		const lhRange = document.getElementById('lhRange');
		const lhValue = document.getElementById('lhValue');
		const alignButtons = document.querySelectorAll('.alignBtn');

		const invertColorsBtn = document.getElementById('invertColors');
		const ratioButtons = document.querySelectorAll('.ratioBtn');

		const downloadBtn = document.getElementById('downloadBtn');
		const resetBtn = document.getElementById('resetBtn');

		// State
		let bgMode = 'solid'; // 'solid' | 'gradient'
		let currentGradient = ''; // css gradient string
		let currentAspect = '1:1';

		// Helpers
		function setBackground() {
			if (bgMode === 'solid') {
				bgLayer.style.background = bgColor.value;
			} else {
				bgLayer.style.background = currentGradient || "linear-gradient(135deg,#6366f1,#a855f7)";
			}
		}

		function setAlignment(alignment) {
			// Update alignment on container and text blocks
			const justifyMap = { left: 'flex-start', center: 'center', right: 'flex-end' };
			mainText.parentElement.parentElement.style.alignItems =
				alignment === 'left' ? 'flex-start' : alignment === 'right' ? 'flex-end' : 'center';
			mainText.style.textAlign = alignment;
			authorText.style.textAlign = alignment;

			// Button states
			alignButtons.forEach(btn => {
				if (btn.dataset.align === alignment) {
					btn.classList.remove('bg-white');
					btn.classList.add('bg-slate-100');
				} else {
					btn.classList.add('bg-white');
					btn.classList.remove('bg-slate-100');
				}
			});
		}

		function clampFontSizeForSafety(sizePx) {
			// Prevent extreme values from breaking layout on tiny screens
			return Math.max(10, Math.min(120, sizePx));
		}

		function updatePreview() {
			// Text content
			mainText.textContent = quoteInput.value || '';
			authorText.textContent = authorInput.value || '';

			// Fonts and sizes
			mainText.style.fontFamily = fontSelect.value;
			authorText.style.fontFamily = authorFontSelect.value;

			const mainSize = clampFontSizeForSafety(parseInt(fontSize.value, 10));
			const authorSize = clampFontSizeForSafety(parseInt(authorFontSize.value, 10));
			mainText.style.fontSize = mainSize + 'px';
			authorText.style.fontSize = authorSize + 'px';

			// Colors
			mainText.style.color = textColor.value;
			authorText.style.color = authorColor.value;

			// Italic author
			authorText.style.fontStyle = authorItalic.checked ? 'italic' : 'normal';

			// Padding (percentage of container)
			const padPct = parseInt(padRange.value, 10);
			cardCanvas.querySelector('.relative.z-10').style.padding = padPct + '%';

			// Line height (applies to both)
			const lineH = parseFloat(lhRange.value);
			mainText.style.lineHeight = lineH.toString();
			authorText.style.lineHeight = lineH.toString();

			// Background
			setBackground();
		}

		function setAspect(ratioStr) {
			// ratioStr like "4:5" or "1.91:1"
			const parts = ratioStr.split(':');
			const w = parseFloat(parts[0]);
			const h = parseFloat(parts[1]);
			if (isFinite(w) && isFinite(h) && w > 0 && h > 0) {
				cardCanvas.style.aspectRatio = `${w} / ${h}`;
				currentAspect = ratioStr;
				if (aspectLabel) {
					aspectLabel.textContent = `Aspect ${currentAspect} • What you see is what you get`;
				}
				// Update active button styles
				ratioButtons.forEach(btn => {
					if (btn.getAttribute('data-ratio') === ratioStr) {
						btn.classList.remove('bg-white');
						btn.classList.add('bg-slate-100');
					} else {
						btn.classList.add('bg-white');
						btn.classList.remove('bg-slate-100');
					}
				});
			}
		}

		function invertTextColors() {
			const m = textColor.value;
			const a = authorColor.value;
			textColor.value = a;
			authorColor.value = m;
			updatePreview();
		}

		function setGradientPreviewStyles() {
			// Visuals for gradient swatch buttons
			gradientSwatches.forEach(btn => {
				const g = btn.getAttribute('data-gradient');
				btn.style.background = g;
			});
		}

		function attachEvents() {
			// Text + author
			[quoteInput, authorInput].forEach(el => el.addEventListener('input', updatePreview));
			authorItalic.addEventListener('change', updatePreview);

			// Fonts and sizes
			fontSelect.addEventListener('change', updatePreview);
			authorFontSelect.addEventListener('change', updatePreview);
			fontSize.addEventListener('input', () => {
				fontSizeValue.textContent = fontSize.value;
				updatePreview();
			});
			authorFontSize.addEventListener('input', () => {
				authorFontSizeValue.textContent = authorFontSize.value;
				updatePreview();
			});

			// Colors
			textColor.addEventListener('input', updatePreview);
			authorColor.addEventListener('input', updatePreview);
			bgColor.addEventListener('input', () => {
				if (bgMode === 'solid') updatePreview();
			});

			// Background mode
			bgModeRadios.forEach(r => {
				r.addEventListener('change', (e) => {
					bgMode = e.target.value;
					updatePreview();
				});
			});

			// Palettes
			paletteSwatches.forEach(btn => {
				btn.addEventListener('click', () => {
					const pal = JSON.parse(btn.getAttribute('data-palette'));
					bgMode = 'solid';
					document.querySelector('input[name="bgMode"][value="solid"]').checked = true;
					bgColor.value = pal.bg;
					textColor.value = pal.text;
					authorColor.value = pal.author;
					updatePreview();
				});
			});

			// Gradients
			setGradientPreviewStyles();
			gradientSwatches.forEach(btn => {
				btn.addEventListener('click', () => {
					bgMode = 'gradient';
					document.querySelector('input[name="bgMode"][value="gradient"]').checked = true;
					currentGradient = btn.getAttribute('data-gradient');
					updatePreview();
				});
			});

			// Layout
			padRange.addEventListener('input', () => {
				padValue.textContent = padRange.value;
				updatePreview();
			});
			lhRange.addEventListener('input', () => {
				lhValue.textContent = lhRange.value;
				updatePreview();
			});
			alignButtons.forEach(btn => {
				btn.addEventListener('click', () => {
					setAlignment(btn.dataset.align);
				});
			});

			// Utilities
			invertColorsBtn.addEventListener('click', (e) => {
				e.preventDefault();
				invertTextColors();
			});

			// Orientation buttons
			ratioButtons.forEach(btn => {
				btn.addEventListener('click', () => {
					const r = btn.getAttribute('data-ratio');
					setAspect(r);
				});
			});

			// Reset
			resetBtn.addEventListener('click', () => {
				quoteInput.value = 'Your inspiring quote goes here. Make it short and impactful.';
				authorInput.value = '— @cardgenio';
				authorItalic.checked = false;

				fontSelect.value = "'Lora', serif";
				authorFontSelect.value = "'Inter', sans-serif";
				fontSize.value = 40; fontSizeValue.textContent = '40';
				authorFontSize.value = 20; authorFontSizeValue.textContent = '20';

				textColor.value = '#0f172a';
				authorColor.value = '#334155';
				bgColor.value = '#ffffff';
				bgMode = 'solid';
				document.querySelector('input[name="bgMode"][value="solid"]').checked = true;
				currentGradient = '';

				padRange.value = 10; padValue.textContent = '10';
				lhRange.value = 1.25; lhValue.textContent = '1.25';

				setAlignment('center');
				setAspect('1:1');
				updatePreview();
			});

			// Download
			downloadBtn.addEventListener('click', async () => {
				downloadBtn.disabled = true;
				downloadBtn.classList.add('opacity-70');
				try {
					// Ensure fonts are loaded before capture
					if (document.fonts && document.fonts.ready) {
						await document.fonts.ready;
					}
					// Temporarily ensure high contrast for watermark on very bright backgrounds
					const originalWMOpacity = watermark.style.opacity || '';
					watermark.style.opacity = '1';

					// Use html2canvas with higher scale for crisp output
					const canvas = await html2canvas(cardCanvas, {
						scale: Math.min(3, window.devicePixelRatio ? 2 * window.devicePixelRatio : 2),
						backgroundColor: null,
						useCORS: true,
						allowTaint: false,
						logging: false
					});

					// Restore watermark state if changed
					watermark.style.opacity = originalWMOpacity;

					const dataURL = canvas.toDataURL('image/png', 1.0);
					const link = document.createElement('a');
					link.href = dataURL;
					link.download = 'cardgenio.png';
					document.body.appendChild(link);
					link.click();
					document.body.removeChild(link);
				} catch (err) {
					console.error(err);
					alert('Failed to generate image. Please try again.');
				} finally {
					downloadBtn.disabled = false;
					downloadBtn.classList.remove('opacity-70');
				}
			});
		}

		// Initialize
		(function init() {
			// Default alignment
			setAlignment('center');
			// Default aspect
			setAspect('1:1');
			// First paint
			updatePreview();
			// Attach listeners
			attachEvents();
		})();
	</script>
</body>
</html>